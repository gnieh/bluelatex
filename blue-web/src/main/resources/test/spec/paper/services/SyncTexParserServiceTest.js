/*
 * This file is part of the \BlueLaTeX project.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

describe('SyncTexParserService', function() {
  var module, factorty;
  // get the app
  beforeEach(function() {
    module = angular.mock.module('bluelatex');

    Object.size = function(obj) {
        var size = 0, key;
        for (key in obj) {
            if (obj.hasOwnProperty(key)) size++;
        }
        return size;
    };
  });

  it("SyncTexParserService should be registered", inject(function(SyncTexParserService) {
    expect(SyncTexParserService).toBeDefined();
  }));

  it("Parse SyncTeX of a null text must return a valid SyncTeX object", inject(function(SyncTexParserService) {
    var synctex = SyncTexParserService.parse(null);
    expect(synctex).toEqual({ 
        version : '', 
        files : {  }, 
        pages : {  }, 
        blockNumberLine : {  }, 
        hBlocks : [  ], 
        numberPages : 0 });
  }));

  it("Parse SyncTeX of an empty text must return a valid SyncTeX object", inject(function(SyncTexParserService) {
    var synctex = SyncTexParserService.parse('');
    expect(synctex).toEqual({ 
        version : '', 
        files : {  }, 
        pages : {  }, 
        blockNumberLine : {  }, 
        hBlocks : [  ], 
        numberPages : 0 });
  }));

  it("Parse SyncTeX of a valid synctex text must return a valid SyncTeX object", inject(function(SyncTexParserService) {
    var synctexText = 'SyncTeX Version:1\nInput:1:/home/thomas/blueMaster/target/pack/data/papers/x5f59b3053b24491b/./main.tex\nInput:2:/usr/share/texlive/texmf-dist/tex/latex/base/article.cls\nInput:3:/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo\nInput:4:/usr/share/texlive/texmf-dist/tex/latex/base/fontenc.sty\nInput:5:/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.def\nInput:6:/usr/share/texlive/texmf-dist/tex/latex/base/inputenc.sty\nInput:7:/usr/share/texlive/texmf-dist/tex/latex/base/utf8.def\nInput:8:/usr/share/texlive/texmf-dist/tex/latex/base/t1enc.dfu\nInput:9:/usr/share/texlive/texmf-dist/tex/latex/base/ot1enc.dfu\nInput:10:/usr/share/texlive/texmf-dist/tex/latex/base/omsenc.dfu\nInput:11:/usr/share/texlive/texmf-dist/tex/latex/geometry/geometry.sty\nInput:12:/usr/share/texlive/texmf-dist/tex/latex/graphics/keyval.sty\nInput:13:/usr/share/texlive/texmf-dist/tex/generic/oberdiek/ifpdf.sty\nInput:14:/usr/share/texlive/texmf-dist/tex/generic/oberdiek/ifvtex.sty\nInput:15:/usr/share/texlive/texmf-dist/tex/generic/ifxetex/ifxetex.sty\nInput:16:/home/thomas/blueMaster/target/pack/data/papers/x5f59b3053b24491b/build/main.aux\nOutput:pdf\nMagnification:1000\nUnit:1\nX Offset:0\nY Offset:0\nContent:\n!1190\n{1\n[1,50:4736287,50335875:31792792,45599588,0\n[1,50:3729360,50335875:32799719,49031347,0\n[1,50:3729360,2090960:32799719,786432,0\nh1,50:3729360,2090960:32799719,0,0\n]\n[1,50:3729360,48369795:32799719,44640435,0\nh1,23:3729360,4384720:0,0,0\n(1,23:3729360,7136912:32799719,779870,0\nk1,23:13461659,7136912:9732299\n(1,23:13461659,7136912:0,0,0\ng1,23:13461659,7136912\ng1,23:13461659,7136912\ng1,23:13133979,7136912\nh1,23:13133979,7136912:0,0,0\ng1,23:13461659,7136912\n)\nx1,23:14230245,7136912\ng1,23:14584780,7136912\nx1,23:15767050,7136912\ng1,23:16121585,7136912\nx1,23:17244706,7136912\nx1,23:22653647,7136912\nx1,23:23037758,7136912\ng1,23:23392293,7136912\nx1,23:24456264,7136912\ng1,23:24810799,7136912\nx1,23:25579385,7136912\nx1,23:26796781,7136912\ng1,23:26796781,7136912\nk1,23:36529079,7136912:9732298\n)\n(1,23:3729360,9037216:32799719,642250,2110262\nk1,23:12054959,9037216:8325599\nh1,23:12054959,9037216:0,0,0\n(1,23:12054959,9037216:6970971,642250,2110262\n$1,23:12054959,9037216\n[1,23:12054959,9037216:6970971,642250,2110262\n(1,23:12054959,9037216:6970971,642250,275254\ng1,23:12054959,9037216\n(1,23:12054959,9037216:6970971,642250,275254\nr1,23:12054959,9037216:0,917504,275254\ng1,23:12448175,9037216\nk1,23:14167528,9037216:1719353\nx1,23:15412135,9037216\ng1,23:15668755,9037216\nx1,23:16913362,9037216\nk1,23:18632714,9037216:1719352\ng1,23:19025930,9037216\n)\ng1,23:19025930,9037216\n)\n(1,23:12054959,9954720:6970971,642250,275254\ng1,23:12054959,9954720\n(1,23:12054959,9954720:6970971,642250,275254\nr1,23:12054959,9954720:0,917504,275254\ng1,23:12448175,9954720\ng1,23:12448175,9954720\nx1,23:18632714,9954720\ng1,23:18632714,9954720\ng1,23:19025930,9954720\n)\ng1,23:19025930,9954720\n)\n(1,23:12054959,10872224:6970971,642250,275254\ng1,23:12054959,10872224\n(1,23:12054959,10872224:6970971,642250,275254\nr1,23:12054959,10872224:0,917504,275254\ng1,23:12448175,10872224\nk1,23:14918141,10872224:2469966\nx1,23:16162748,10872224\nk1,23:18632714,10872224:2469966\ng1,23:19025930,10872224\n)\ng1,23:19025930,10872224\n)\n]\n$1,23:19025930,9037216\n)\nk1,23:21211126,9037216:2185196\n(1,23:21211126,9037216:6992354,642250,2110262\n$1,23:21211126,9037216\n[1,23:21211126,9037216:6992354,642250,2110262\n(1,23:21211126,9037216:6992354,642250,275254\ng1,23:21211126,9037216\n(1,23:21211126,9037216:6992354,642250,275254\nr1,23:21211126,9037216:0,917504,275254\ng1,23:21604342,9037216\nk1,23:22205396,9037216:601054\nx1,23:22782518,9037216\nx1,23:23830383,9037216\ng1,23:24087003,9037216\nx1,23:27209210,9037216\nk1,23:27810264,9037216:601054\ng1,23:28203480,9037216\n)\ng1,23:28203480,9037216\n)\n(1,23:21211126,9954720:6992354,642250,275254\ng1,23:21211126,9954720\n(1,23:21211126,9954720:6992354,642250,275254\nr1,23:21211126,9954720:0,917504,275254\ng1,23:21604342,9954720\ng1,23:21604342,9954720\nx1,23:27810264,9954720\ng1,23:27810264,9954720\ng1,23:28203480,9954720\n)\ng1,23:28203480,9954720\n)\n(1,23:21211126,10872224:6992354,642250,275254\ng1,23:21211126,10872224\n(1,23:21211126,10872224:6992354,642250,275254\nr1,23:21211126,10872224:0,917504,275254\ng1,23:21604342,10872224\nk1,23:23261815,10872224:1657473\nx1,23:26152792,10872224\nk1,23:27810264,10872224:1657472\ng1,23:28203480,10872224\n)\ng1,23:28203480,10872224\n)\n]\n$1,23:28203480,9037216\n)\ng1,23:28203480,9037216\nk1,23:36529079,9037216:8325599\n)\n(1,23:3729360,12409846:32799719,541632,152880\nk1,23:16835929,12409846:13106569\nh1,23:16835929,12409846:0,0,0\nx1,23:19316591,12409846\nx1,23:19722906,12409846\nx1,23:20385841,12409846\ng1,23:20642461,12409846\nx1,23:21626170,12409846\ng1,23:21882790,12409846\nx1,23:23422510,12409846\ng1,23:23422510,12409846\nk1,23:36529079,12409846:13106569\n)\n(1,25:3729360,15232204:32799719,651269,0\n(1,25:3729360,15232204:1556764,603533,0\ng1,25:3729360,15232204\nx1,25:4248281,15232204\ng1,25:5286124,15232204\n)\nx1,25:7460759,15232204\ng1,25:7806707,15232204\nx1,25:11103839,15232204\nk1,25:36529079,15232204:25425240\ng1,25:36529079,15232204\n)\n(1,27:3729360,16667466:32799719,451360,0\nx1,27:5258160,16667466\ng1,26:5476560,16667466\nx1,26:6623160,16667466\ng1,26:6841560,16667466\nx1,26:7355710,16667466\nk1,27:36529079,16667466:29173369\ng1,27:36529079,16667466\n)\n(1,36:3729360,17453898:32799719,451360,0\nh1,28:3729360,17453898:983040,0,0\nx1,28:5094600,17453898\ng1,28:5313000,17453898\nx1,28:5677000,17453898\ng1,29:5895400,17453898\nx1,29:6259400,17453898\ng1,30:6477800,17453898\nx1,30:6841800,17453898\ng1,31:7060200,17453898\nx1,31:8152200,17453898\ng1,32:8370600,17453898\nx1,32:9098600,17453898\ng1,33:9317000,17453898\nx1,33:9681000,17453898\ng1,34:9899400,17453898\nx1,34:10263400,17453898\nk1,36:36529079,17453898:26265679\ng1,36:36529079,17453898\n)\n(1,39:3729360,18240330:32799719,451360,0\nh1,37:3729360,18240330:983040,0,0\nx1,37:5076400,18240330\ng1,37:5294800,18240330\nx1,37:5658800,18240330\nk1,39:36529079,18240330:30870279\ng1,39:36529079,18240330\n)\n(1,40:3729360,19026762:32799719,0,0\nh1,40:3729360,19026762:983040,0,0\nk1,40:36529079,19026762:31816679\ng1,40:36529079,19026762\n)\n(1,40:18297427,20261027:3663585,1168729,830854\n[1,40:18297427,20261027:987521,1168729,830854\n(1,40:18297427,19441824:987521,283990,54614\nk1,40:18328793,19441824:31366\nx1,40:19253582,19441824\nk1,40:19284948,19441824:31366\n)\n(1,40:18297427,20261027:987521,688132,360452\nk1,40:18317871,20261027:20444\n(1,40:18317871,19638431:946633,65536,983048\nx1,40:19264504,19638431\n)\nk1,40:19284948,20261027:20444\n)\n(1,40:18297427,21026345:987521,295640,0\nx1,40:19284948,21026345\n)\n]\ng1,40:19394172,20261027\n(1,40:19394172,20261027:844659,865699,449545\n(1,40:19394172,20261027:844659,865699,449545\nh1,40:19394172,20261027:78643,0,0\n[1,40:19472815,20261027:687373,865699,449545\n(1,40:19472815,19817671:687373,422343,0\nk1,40:19652661,19817671:179846\nx1,40:19980342,19817671\nk1,40:20160188,19817671:179846\n)\n(1,40:19472815,20710571:687373,484966,0\nx1,40:19866185,20710571\n(1,40:19866185,20521245:294003,295640,0\nx1,40:20127420,20521245\n)\n)\n]\nh1,40:20160188,20261027:78643,0,0\n)\n)\ng1,40:20420871,20261027\nx1,40:20930597,20261027\ng1,40:21112637,20261027\n(1,40:21112637,20261027:848375,976821,449545\n(1,40:21112637,20261027:848375,976821,449545\nh1,40:21112637,20261027:78643,0,0\n[1,40:21191280,20261027:691089,976821,449545\n(1,40:21191280,19817671:691089,533465,0\nx1,40:21564853,19817671\n(1,40:21588366,19579846:294003,295640,0\nx1,40:21849601,19579846\n)\n)\n(1,40:21191280,20710571:691089,422343,0\nk1,40:21372984,20710571:181704\nx1,40:21700665,20710571\nk1,40:21882369,20710571:181704\n)\n]\nh1,40:21882369,20261027:78643,0,0\n)\n)\n)\n(1,41:3729360,22796036:32799719,651269,0\n(1,41:3729360,22796036:1556764,603533,0\ng1,41:3729360,22796036\nx1,41:4248281,22796036\ng1,41:5286124,22796036\n)\nx1,41:8467942,22796036\ng1,41:8813890,22796036\nx1,41:12111022,22796036\nk1,41:36529079,22796036:24418057\ng1,41:36529079,22796036\n)\n(1,44:3729360,24231298:32799719,451360,0\nx1,44:5876960,24231298\nk1,44:36529079,24231298:30652119\ng1,44:36529079,24231298\n)\n(1,47:3729360,25017730:32799719,451360,127400\nh1,46:3729360,25017730:983040,0,0\nx1,46:6678000,25017730\ng1,46:6896400,25017730\nx1,46:7224000,25017730\ng1,46:7442400,25017730\nx1,46:8174040,25017730\ng1,46:8392440,25017730\nx1,46:9633680,25017730\nk1,47:36529079,25017730:26895399\ng1,47:36529079,25017730\n)\n]\n(1,50:3729360,50335875:32799719,420420,0\nk1,50:19965420,50335875:16236060\nx1,50:20293020,50335875\nk1,50:36529079,50335875:16236059\n)\n]\n]\n!7227\n}1\nInput:17:/home/thomas/blueMaster/target/pack/data/papers/x5f59b3053b24491b/build/main.aux\n!99\nPostamble:\nCount:231\n!25\nPost scriptum:\n';
    var synctex = SyncTexParserService.parse(synctexText);
    expect(synctex.version).toEqual('1');
    expect(Object.size(synctex.files)).toEqual(17);
    expect(Object.size(synctex.pages)).toEqual(1);
    expect(Object.size(synctex.blockNumberLine)).toEqual(1);
    expect(synctex.hBlocks.length).toEqual(44);
    expect(synctex.numberPages).toEqual(1);
  }));

});